(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{117:function(e,t,n){},123:function(e,t,n){},125:function(e,t,n){},126:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(1),s=n(30),r=n.n(s),o=n(4),i=n.n(o),l=n(7),u=n(6),j=n(34),m=n(2),b="[Chat] Usuarios cargados",d="[Chat] Activar Chat",p="[Chat] Nuevo Mensaje",h="[Chat] Cargar Mensajes",O="[Chat] Cerrar Sesion",x={uid:"",chatActivo:null,usuarios:[],mensajes:[]},f=function(e,t){switch(t.type){case O:return Object(m.a)({},x);case b:return Object(m.a)(Object(m.a)({},e),{},{usuarios:Object(j.a)(t.payload)});case d:return e.chatActivo===t.payload?e:Object(m.a)(Object(m.a)({},e),{},{chatActivo:t.payload,mensajes:[]});case p:return e.chatActivo===t.payload.de||e.chatActivo===t.payload.para?Object(m.a)(Object(m.a)({},e),{},{mensajes:[].concat(Object(j.a)(e.mensajes),[t.payload])}):e;case h:return Object(m.a)(Object(m.a)({},e),{},{mensajes:Object(j.a)(t.payload.reverse())});default:return e}},v=Object(c.createContext)(),g={uid:"",chatActivo:null,usuarios:[],mensajes:[]},k=function(e){var t=e.children,n=Object(c.useReducer)(f,g),s=Object(u.a)(n,2),r=s[0],o=s[1];return console.log("ChatProvider"),Object(a.jsx)(v.Provider,{value:{chatState:r,dispatch:o},children:t})},N="https://chatrealtime-socket-react-node.herokuapp.com/api",_=function(){var e=Object(l.a)(i.a.mark((function e(t,n){var a,c,s,r,o=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=o.length>2&&void 0!==o[2]?o[2]:"GET",e.prev=1,c="".concat(N,"/").concat(t),console.log(c),"GET"!==a){e.next=13;break}return e.next=7,fetch(c);case 7:return s=e.sent,e.next=10,s.json();case 10:return e.abrupt("return",e.sent);case 13:return e.next=15,fetch(c,{method:a,headers:{"Content-type":"application/json"},body:JSON.stringify(n)});case 15:return r=e.sent,e.next=18,r.json();case 18:return e.abrupt("return",e.sent);case 19:e.next=25;break;case 21:return e.prev=21,e.t0=e.catch(1),console.log({err:e.t0.name,message:e.t0.message}),e.abrupt("return",{err:e.t0.name,message:e.t0.message});case 25:case"end":return e.stop()}}),e,null,[[1,21]])})));return function(t,n){return e.apply(this,arguments)}}(),w=function(){var e=Object(l.a)(i.a.mark((function e(t,n){var a,c,s,r,o,l=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=l.length>2&&void 0!==l[2]?l[2]:"GET",e.prev=1,c="".concat(N,"/").concat(t),s=localStorage.getItem("token")||"","GET"!==a){e.next=13;break}return e.next=7,fetch(c,{headers:{"x-token":s}});case 7:return r=e.sent,e.next=10,r.json();case 10:return e.abrupt("return",e.sent);case 13:return e.next=15,fetch(c,{method:a,headers:{"Content-type":"application/json","x-token":s},body:JSON.stringify(n)});case 15:return o=e.sent,e.next=18,o.json();case 18:return e.abrupt("return",e.sent);case 19:e.next=25;break;case 21:return e.prev=21,e.t0=e.catch(1),console.log({err:e.t0.name,message:e.t0.message}),e.abrupt("return",{err:e.t0.name,message:e.t0.message});case 25:case"end":return e.stop()}}),e,null,[[1,21]])})));return function(t,n){return e.apply(this,arguments)}}(),C=Object(c.createContext)(),y={uid:null,checking:!0,logged:!1,name:null,email:null},S=function(e){var t=e.children,n=Object(c.useState)(y),s=Object(u.a)(n,2),r=s[0],o=s[1],j=Object(c.useContext)(v).dispatch;console.log("_________________________________"),console.log("AuthContextProvider",r);var m=function(){var e=Object(l.a)(i.a.mark((function e(t,n){var a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_("login",{email:t,password:n},"POST");case 2:return(a=e.sent).ok&&(localStorage.setItem("token",a.token),c=a.usuario,o({uid:c.uid,checking:!1,logged:!0,name:c.nombre,email:c.email})),e.abrupt("return",a.ok);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),b=function(){var e=Object(l.a)(i.a.mark((function e(t,n,a){var c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_("login/new",{nombre:t,email:n,password:a},"POST");case 2:if(!(c=e.sent).ok){e.next=8;break}return localStorage.setItem("token",c.token),s=c.usuario,o({uid:s.uid,checking:!1,logged:!0,name:s.nombre,email:s.email}),e.abrupt("return",!0);case 8:return e.abrupt("return",c.msg);case 9:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),d=Object(c.useCallback)(Object(l.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("token")){e.next=4;break}return o({uid:null,checking:!1,logged:!1,name:null,email:null}),e.abrupt("return",!1);case 4:return e.next=6,w("login/renew");case 6:if(!(t=e.sent).ok){e.next=15;break}return localStorage.setItem("token",t.token),n=t.usuario,o({uid:n.uid,checking:!1,logged:!0,name:n.nombre,email:n.email}),console.log("verificarTokenExistenteResp.ok"),e.abrupt("return",!0);case 15:return o({uid:null,checking:!1,logged:!1,name:null,email:null}),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e)}))),[]);return Object(a.jsx)(C.Provider,{value:{auth:r,login:m,register:b,verificaToken:d,logout:function(){localStorage.removeItem("token"),j({type:O}),o({checking:!1,logged:!1})}},children:t})},E=n(68),A=n.n(E),I=n(49),P=Object(c.createContext)(),T=function(e){var t=e.children,n=function(e){var t=Object(c.useState)(null),n=Object(u.a)(t,2),a=n[0],s=n[1],r=Object(c.useState)(!1),o=Object(u.a)(r,2),i=o[0],l=o[1],j=Object(c.useCallback)((function(){var t=localStorage.getItem("token"),n=A.a.connect(e,{transports:["websocket"],autoConnect:!0,forceNew:!0,query:{"x-token":t}});s(n)}),[e]),m=Object(c.useCallback)((function(){null===a||void 0===a||a.disconnect()}),[a]);return Object(c.useEffect)((function(){l(null===a||void 0===a?void 0:a.connected)}),[a]),Object(c.useEffect)((function(){null===a||void 0===a||a.on("connect",(function(){l(!0)}))}),[a]),Object(c.useEffect)((function(){null===a||void 0===a||a.on("disconnect",(function(){l(!1)}))}),[a]),{socket:a,online:i,conectarSocket:j,desconectarSocket:m}}("https://chatrealtime-socket-react-node.herokuapp.com"),s=n.socket,r=n.online,o=n.conectarSocket,i=n.desconectarSocket;console.log("SOCKET","https://chatrealtime-socket-react-node.herokuapp.com"),console.log("SOCKET",s);var l=Object(c.useContext)(C).auth,j=Object(c.useContext)(v).dispatch;return Object(c.useEffect)((function(){l.logged&&o()}),[l,o]),Object(c.useEffect)((function(){l.logged||i()}),[l,i]),Object(c.useEffect)((function(){null===s||void 0===s||s.on("lista-usuarios",(function(e){console.log("callback users",e),j({type:b,payload:e})}))}),[s,j]),Object(c.useEffect)((function(){null===s||void 0===s||s.on("mensaje-personal",(function(e){var t;j({type:p,payload:e}),t="mensajes",I.animateScroll.scrollToBottom({containerId:t,duration:250})}))}),[s,j]),Object(a.jsx)(P.Provider,{value:{socket:s,online:r},children:t})},M=n(16),R=n(3),D=function(){return Object(a.jsx)("div",{className:"middle-screen",children:Object(a.jsxs)("div",{className:"alert-info",children:[Object(a.jsx)("hr",{}),Object(a.jsx)("h3",{children:"Seleccione una persona"}),Object(a.jsx)("span",{children:"Para comenzar una conversaci\xf3n"})]})})},G=function(){var e=Object(c.useContext)(C),t=e.auth,n=e.logout;return Object(a.jsxs)("div",{className:"headind_srch",children:[Object(a.jsx)("div",{className:"recent_heading mt-2",children:Object(a.jsx)("h4",{children:t.name})}),Object(a.jsx)("div",{className:"srch_bar",children:Object(a.jsx)("div",{className:"stylish-input-group",children:Object(a.jsx)("button",{className:"btn text-danger",onClick:n,children:"Salir"})})})]})},J=function(e){var t=e.usuario,n=Object(c.useContext)(v),s=n.chatState,r=n.dispatch,o=s.chatActivo,u=function(){var e=Object(l.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r({type:d,payload:t.uid}),e.next=3,w("mensajes/".concat(t.uid));case 3:n=e.sent,r({type:h,payload:n.mensajes}),a="mensajes",I.animateScroll.scrollToBottom({containerId:a,duration:0});case 6:case"end":return e.stop()}var a}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.jsx)("div",{className:"chat_list ".concat(t.uid===o&&"active_chat"),onClick:u,children:Object(a.jsxs)("div",{className:"chat_people",children:[Object(a.jsx)("div",{className:"chat_img",children:Object(a.jsx)("img",{src:"https://p.kindpng.com/picc/s/78-786207_user-avatar-png-user-avatar-icon-png-transparent.png",alt:"sunil"})}),Object(a.jsxs)("div",{className:"chat_ib",children:[Object(a.jsxs)("h5",{children:[" ",t.nombre," "]}),t.online?Object(a.jsx)("span",{className:"text-success",children:"Online"}):Object(a.jsx)("span",{className:"text-danger",children:"Offline"})]})]})})},B=function(){var e=Object(c.useContext)(v).chatState,t=Object(c.useContext)(C).auth.uid;return Object(a.jsxs)("div",{className:"inbox_chat",children:[e.usuarios.filter((function(e){return e.uid!==t})).map((function(e){return Object(a.jsx)(J,{usuario:e},e.uid)})),Object(a.jsx)("div",{className:"extra_space"})]})},q=function(){return Object(a.jsxs)("div",{className:"inbox_people",children:[Object(a.jsx)(G,{}),Object(a.jsx)(B,{})]})},z=n(22),H=n.n(z),K=function(e){return H()(e).format("HH:mm a | MMMM Do")},U=function(e){var t=e.msg;return Object(a.jsxs)("div",{className:"incoming_msg",children:[Object(a.jsx)("div",{className:"incoming_msg_img",children:Object(a.jsx)("img",{src:"https://ptetutorials.com/images/user-profile.png",alt:"sunil"})}),Object(a.jsx)("div",{className:"received_msg",children:Object(a.jsxs)("div",{className:"received_withd_msg",children:[Object(a.jsx)("p",{children:t.mensaje}),Object(a.jsxs)("span",{className:"time_date",children:[" ",K(t.createdAt)]})]})})]})},V=function(e){var t=e.msg;return Object(a.jsx)("div",{className:"outgoing_msg",children:Object(a.jsxs)("div",{className:"sent_msg",children:[Object(a.jsx)("p",{children:t.mensaje}),Object(a.jsxs)("span",{className:"time_date",children:[" ",K(t.createdAt)," "]})]})})},Y=function(){var e=Object(c.useState)(""),t=Object(u.a)(e,2),n=t[0],s=t[1],r=Object(c.useContext)(P).socket,o=Object(c.useContext)(C).auth,i=Object(c.useContext)(v).chatState;return Object(a.jsx)("form",{onSubmit:function(e){e.preventDefault(),0!==n.length&&(s(""),r.emit("mensaje-personal",{de:o.uid,para:i.chatActivo,mensaje:n}))},children:Object(a.jsxs)("div",{className:"type_msg row",children:[Object(a.jsx)("div",{className:"input_msg_write col-sm-9",children:Object(a.jsx)("input",{type:"text",className:"write_msg",placeholder:"Mensaje...",value:n,onChange:function(e){var t=e.target;s(t.value)}})}),Object(a.jsx)("div",{className:"col-sm-3 text-center",children:Object(a.jsx)("button",{className:"msg_send_btn mt-3",type:"submit",children:"enviar"})})]})})},F=function(){var e=Object(c.useContext)(v).chatState,t=Object(c.useContext)(C).auth;return Object(a.jsxs)("div",{className:"mesgs",children:[Object(a.jsx)("div",{id:"mensajes",className:"msg_history",children:e.mensajes.map((function(e){return e.para===t.uid?Object(a.jsx)(U,{msg:e},e._id):Object(a.jsx)(V,{msg:e},e._id)}))}),Object(a.jsx)(Y,{})]})},L=(n(117),function(){var e=Object(c.useContext)(v).chatState;return Object(a.jsx)("div",{className:"messaging",children:Object(a.jsxs)("div",{className:"inbox_msg",children:[Object(a.jsx)(q,{}),e.chatActivo?Object(a.jsx)(F,{}):Object(a.jsx)(D,{})]})})}),Q=n(20),W=n(32),X=n.n(W),Z=function(){var e=Object(c.useContext)(C).login,t=Object(c.useState)({email:"",password:"",rememberme:!1}),n=Object(u.a)(t,2),s=n[0],r=n[1];Object(c.useEffect)((function(){var e=localStorage.getItem("email");e&&r((function(t){return Object(m.a)(Object(m.a)({},t),{},{email:e,rememberme:!0})}))}),[]);var o=function(e){var t=e.target,n=t.name,a=t.value;r(Object(m.a)(Object(m.a)({},s),{},Object(Q.a)({},n,a)))},j=function(){var t=Object(l.a)(i.a.mark((function t(n){var a,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),s.rememberme?localStorage.setItem("email",s.email):localStorage.removeItem("email"),a=s.email,c=s.password,t.next=5,e(a,c);case 5:t.sent||X.a.fire("Error","Verifique el usuario y contrase\xf1a","error");case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(a.jsxs)("form",{className:"login100-form validate-form flex-sb flex-w",onSubmit:j,children:[Object(a.jsx)("span",{className:"login100-form-title mb-3",children:"Chat - Ingreso"}),Object(a.jsxs)("div",{className:"wrap-input100 validate-input mb-3",children:[Object(a.jsx)("input",{className:"input100",type:"email",name:"email",placeholder:"Email",value:s.email,onChange:o}),Object(a.jsx)("span",{className:"focus-input100"})]}),Object(a.jsxs)("div",{className:"wrap-input100 validate-input mb-3",children:[Object(a.jsx)("input",{className:"input100",type:"password",name:"password",placeholder:"Password",value:s.password,onChange:o}),Object(a.jsx)("span",{className:"focus-input100"})]}),Object(a.jsxs)("div",{className:"row mb-3",children:[Object(a.jsxs)("div",{className:"col",onClick:function(){return console.log("??"),void r(Object(m.a)(Object(m.a)({},s),{},{rememberme:!s.rememberme}))},children:[Object(a.jsx)("input",{className:"input-checkbox100",id:"ckb1",type:"checkbox",name:"rememberme",checked:s.rememberme,readOnly:!0}),Object(a.jsx)("label",{className:"label-checkbox100",children:"Recordarme"})]}),Object(a.jsx)("div",{className:"col text-right",children:Object(a.jsx)(M.b,{to:"/auth/register",className:"txt1",children:"Nueva cuenta?"})})]}),Object(a.jsx)("div",{className:"container-login100-form-btn m-t-17",children:Object(a.jsx)("button",{type:"submit",className:"login100-form-btn",disabled:!(s.email.length>0&&s.password.length>0),children:"Ingresar"})})]})},$=function(){var e=Object(c.useContext)(C).register,t=Object(c.useState)({email:"test6@test.com",password:"123456",name:"Susana Paz"}),n=Object(u.a)(t,2),s=n[0],r=n[1],o=function(e){var t=e.target,n=t.name,a=t.value;r(Object(m.a)(Object(m.a)({},s),{},Object(Q.a)({},n,a)))},j=function(){var t=Object(l.a)(i.a.mark((function t(n){var a,c,r,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),a=s.email,c=s.password,r=s.name,t.next=4,e(r,a,c);case 4:!0!==(o=t.sent)&&X.a.fire("Error",o,"error");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(a.jsxs)("form",{className:"login100-form validate-form flex-sb flex-w",onSubmit:j,children:[Object(a.jsx)("span",{className:"login100-form-title mb-3",children:"Chat - Registro"}),Object(a.jsxs)("div",{className:"wrap-input100 validate-input mb-3",children:[Object(a.jsx)("input",{className:"input100",type:"text",name:"name",placeholder:"Nombre",value:s.name,onChange:o}),Object(a.jsx)("span",{className:"focus-input100"})]}),Object(a.jsxs)("div",{className:"wrap-input100 validate-input mb-3",children:[Object(a.jsx)("input",{className:"input100",type:"email",name:"email",placeholder:"Email",value:s.email,onChange:o}),Object(a.jsx)("span",{className:"focus-input100"})]}),Object(a.jsxs)("div",{className:"wrap-input100 validate-input mb-3",children:[Object(a.jsx)("input",{className:"input100",type:"password",name:"password",placeholder:"Password",value:s.password,onChange:o}),Object(a.jsx)("span",{className:"focus-input100"})]}),Object(a.jsx)("div",{className:"row mb-3",children:Object(a.jsx)("div",{className:"col text-right",children:Object(a.jsx)(M.b,{to:"/auth/login",className:"txt1",children:"Ya tienes cuenta?"})})}),Object(a.jsx)("div",{className:"container-login100-form-btn m-t-17",children:Object(a.jsx)("button",{type:"submit",className:"login100-form-btn",disabled:!(s.email.length>0&&s.password.length>0&&s.name.length>0),children:"Crear cuenta"})})]})},ee=(n(123),function(){return Object(a.jsx)("div",{className:"limiter",children:Object(a.jsx)("div",{className:"container-login100",children:Object(a.jsx)("div",{className:"wrap-login100 p-t-50 p-b-90",children:Object(a.jsxs)(R.d,{children:[Object(a.jsx)(R.b,{exact:!0,path:"/auth/login",component:Z}),Object(a.jsx)(R.b,{exact:!0,path:"/auth/register",component:$}),Object(a.jsx)(R.a,{to:"/auth/login"})]})})})})}),te=n(33),ne=function(e){var t=e.isAuthenticated,n=e.component,c=Object(te.a)(e,["isAuthenticated","component"]);return console.log("PublicRoute"),Object(a.jsx)(R.b,Object(m.a)(Object(m.a)({},c),{},{component:function(e){return t?Object(a.jsx)(R.a,{to:"/"}):Object(a.jsx)(n,Object(m.a)({},e))}}))},ae=function(e){var t=e.isAuthenticated,n=e.component,c=Object(te.a)(e,["isAuthenticated","component"]);return console.log("PrivateRoute"),Object(a.jsx)(R.b,Object(m.a)(Object(m.a)({},c),{},{component:function(e){return t?Object(a.jsx)(n,Object(m.a)({},e)):Object(a.jsx)(R.a,{to:"/auth"})}}))},ce=function(){var e=Object(c.useContext)(C),t=e.auth,n=e.verificaToken;return console.log("AppRouter",window.location.href),Object(c.useEffect)((function(){n()}),[n]),t.checking?Object(a.jsx)("h1",{children:"Espere por favor"}):Object(a.jsx)(M.a,{children:Object(a.jsx)("div",{children:Object(a.jsxs)(R.d,{children:[Object(a.jsx)(ne,{isAuthenticated:t.logged,path:"/auth",component:ee}),Object(a.jsx)(ae,{isAuthenticated:t.logged,exact:!0,path:"/",component:L}),Object(a.jsx)(R.a,{to:"/"})]})})})};n(124);H.a.locale("es");var se=function(){return Object(a.jsx)(k,{children:Object(a.jsx)(S,{children:Object(a.jsx)(T,{children:Object(a.jsx)(ce,{})})})})};n(125);r.a.render(Object(a.jsx)(se,{}),document.getElementById("root"))}},[[126,1,2]]]);
//# sourceMappingURL=main.549cb17c.chunk.js.map